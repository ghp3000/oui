import{_ as o,r as c,o as p,c as l,b as n,a,e as t,d as e}from"./app.9299992b.js";const i={},u=t(`<h1 id="lua-\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#lua-\u63A5\u53E3" aria-hidden="true">#</a> Lua \u63A5\u53E3</h1><p>\u5728 Oui \u4E2D\uFF0CLua \u63A5\u53E3\u4EE5 <code>\u6A21\u5757-\u65B9\u6CD5</code> \u7684\u5F62\u5F0F\u8FDB\u884C\u7EC4\u7EC7\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>root@OpenWrt:~<span class="token comment"># ls /usr/share/oui/rpc/</span>
acl.lua       network.lua   ubus.lua      ui.lua        wireless.lua
demo.lua      system.lua    uci.lua       user.lua
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u7684\u6BCF\u4E2A Lua \u6587\u4EF6\u4EE3\u8868\u7740\u4E00\u4E2A\u6A21\u5757\u3002\u6A21\u5757\u540D\u4E3A Lua \u6587\u4EF6\u540D\uFF08\u4E0D\u5E26\u540E\u7F00\uFF09\u3002</p><p>\u6BCF\u4E2A Lua \u63A5\u53E3\u6587\u4EF6\u9700\u8981\u8FD4\u56DE\u4E00\u4E2A <code>Lua Table</code>\uFF0C\u8BE5 <code>Lua Table</code> \u7531\u591A\u4E2A <code>Lua function</code> \u7EC4\u6210\u3002</p><div class="language-lua ext-lua line-numbers-mode"><pre class="language-lua"><code><span class="token comment">-- /usr/share/oui/rpc/test.lua</span>

<span class="token keyword">local</span> M <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">--[[
param: \u524D\u7AEF\u8C03\u7528\u4F20\u9012\u7684\u53C2\u6570
section: \u767B\u5F55\u7684\u4F1A\u8BDD\u4FE1\u606F\uFF0C\u4E3A\u4E00\u4E2A Table\uFF0C
         \u5305\u542B\u5F53\u524D\u767B\u5F55\u7684\u7528\u6237\u540D(username)\u548C\u5176\u6240\u5C5E\u7684\u6743\u9650\u7EC4(acl)
--]]</span>
<span class="token keyword">function</span> M<span class="token punctuation">.</span><span class="token function">func1</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> section<span class="token punctuation">)</span>
    <span class="token keyword">local</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">...</span>
    <span class="token keyword">return</span> res
<span class="token keyword">end</span>

<span class="token keyword">return</span> M
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$oui</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;func1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u53C2\u8003\u8D44\u6599" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u8D44\u6599" aria-hidden="true">#</a> \u53C2\u8003\u8D44\u6599</h2>`,8),r={href:"https://openwrt.org/docs/techref/uci#lua_bindings_for_uci",target:"_blank",rel:"noopener noreferrer"},d=e("lua-uci"),k={href:"https://github.com/openresty/lua-nginx-module",target:"_blank",rel:"noopener noreferrer"},v=e("lua-nginx-module"),m={href:"https://github.com/mpx/lua-cjson",target:"_blank",rel:"noopener noreferrer"},b=e("lua-cjson"),h=t(`<h2 id="\u5EF6\u8FDF\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#\u5EF6\u8FDF\u5E94\u7528" aria-hidden="true">#</a> \u5EF6\u8FDF\u5E94\u7528</h2><div class="language-lua ext-lua line-numbers-mode"><pre class="language-lua"><code><span class="token comment">-- \u5EF6\u8FDF 0.5s \u6267\u884C\u5347\u7EA7\u64CD\u4F5C</span>
<span class="token keyword">function</span> M<span class="token punctuation">.</span><span class="token function">sysupgrade</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
    ngx<span class="token punctuation">.</span>timer<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">local</span> arg <span class="token operator">=</span> param<span class="token punctuation">.</span>keep <span class="token keyword">and</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">or</span> <span class="token string">&#39;-n&#39;</span>
        os<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">&#39;sysupgrade &#39;</span> <span class="token operator">..</span> arg <span class="token operator">..</span> <span class="token string">&#39; /tmp/firmware.bin&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u65E5\u5FD7" tabindex="-1"><a class="header-anchor" href="#\u65E5\u5FD7" aria-hidden="true">#</a> \u65E5\u5FD7</h2><div class="language-lua ext-lua line-numbers-mode"><pre class="language-lua"><code>ngx<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ngx<span class="token punctuation">.</span>ERR<span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; nginx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; ok&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="\u5173\u95ED-lua-\u4EE3\u7801\u7F13\u5B58" tabindex="-1"><a class="header-anchor" href="#\u5173\u95ED-lua-\u4EE3\u7801\u7F13\u5B58" aria-hidden="true">#</a> \u5173\u95ED Lua \u4EE3\u7801\u7F13\u5B58</h2><p>\u8C03\u8BD5\u8FC7\u7A0B\u53EF\u5173\u95ED <code>lua-nginx</code> \u6A21\u5757\u7684 Lua \u4EE3\u7801\u7F13\u5B58\u529F\u80FD\uFF0C\u65B9\u4FBF\u8C03\u8BD5\u3002</p><p>\u4FEE\u6539 <code>/etc/nginx/conf.d/oui.conf</code></p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">gzip_static</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">lua_shared_dict</span> nonces <span class="token number">16k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">lua_shared_dict</span> sessions <span class="token number">16k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">lua_code_cache</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">\xA0</div></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u6267\u884C <code>/etc/init.d/nginx reload</code></p>`,9);function g(_,f){const s=c("ExternalLinkIcon");return p(),l("div",null,[u,n("ul",null,[n("li",null,[n("a",r,[d,a(s)])]),n("li",null,[n("a",k,[v,a(s)])]),n("li",null,[n("a",m,[b,a(s)])])]),h])}const y=o(i,[["render",g],["__file","lua-api.html.vue"]]);export{y as default};
